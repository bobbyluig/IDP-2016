import json
import requests
import datetime
import calendar
from bs4 import BeautifulSoup
import numpy as np
import csv


url1 = 'http://neo.sci.gsfc.nasa.gov/view.php?datasetId=MYD28M&year={}'
url2 = 'http://neo.sci.gsfc.nasa.gov/servlet/RenderData?si={}&cs=rgb&format=CSV&width=360&height=180'
url3 = 'http://neo.sci.gsfc.nasa.gov/view.php?datasetId=AVHRR_SST_M&year={}'
ids1 = [{'date': '2002-07-01', 'si': '1693266'}, {'date': '2002-08-01', 'si': '1693274'}, {'date': '2002-09-01', 'si': '1693281'}, {'date': '2002-10-01', 'si': '1693289'}, {'date': '2002-11-01', 'si': '1693294'}, {'date': '2002-12-01', 'si': '1693270'}, {'date': '2003-01-01', 'si': '1693288'}, {'date': '2003-02-01', 'si': '1693298'}, {'date': '2003-03-01', 'si': '1693416'}, {'date': '2003-04-01', 'si': '1693413'}, {'date': '2003-05-01', 'si': '1693430'}, {'date': '2003-06-01', 'si': '1693436'}, {'date': '2003-07-01', 'si': '1693425'}, {'date': '2003-08-01', 'si': '1693431'}, {'date': '2003-09-01', 'si': '1693302'}, {'date': '2003-10-01', 'si': '1693309'}, {'date': '2003-11-01', 'si': '1693317'}, {'date': '2003-12-01', 'si': '1693323'}, {'date': '2004-01-01', 'si': '1693332'}, {'date': '2004-02-01', 'si': '1693307'}, {'date': '2004-03-01', 'si': '1693322'}, {'date': '2004-04-01', 'si': '1693335'}, {'date': '2004-05-01', 'si': '1693342'}, {'date': '2004-06-01', 'si': '1693350'}, {'date': '2004-07-01', 'si': '1693356'}, {'date': '2004-08-01', 'si': '1693363'}, {'date': '2004-09-01', 'si': '1693370'}, {'date': '2004-10-01', 'si': '1693352'}, {'date': '2004-11-01', 'si': '1693367'}, {'date': '2004-12-01', 'si': '1693374'}, {'date': '2005-01-01', 'si': '1693383'}, {'date': '2005-02-01', 'si': '1693389'}, {'date': '2005-03-01', 'si': '1693396'}, {'date': '2005-04-01', 'si': '1693404'}, {'date': '2005-05-01', 'si': '1693382'}, {'date': '2005-06-01', 'si': '1693394'}, {'date': '2005-07-01', 'si': '1693421'}, {'date': '2005-08-01', 'si': '1693445'}, {'date': '2005-09-01', 'si': '1693453'}, {'date': '2005-10-01', 'si': '1693460'}, {'date': '2005-11-01', 'si': '1693468'}, {'date': '2005-12-01', 'si': '1693438'}, {'date': '2006-01-01', 'si': '1693458'}, {'date': '2006-02-01', 'si': '1693470'}, {'date': '2006-03-01', 'si': '1693478'}, {'date': '2006-04-01', 'si': '1693486'}, {'date': '2006-05-01', 'si': '1693493'}, {'date': '2006-06-01', 'si': '1693499'}, {'date': '2006-07-01', 'si': '1693507'}, {'date': '2006-08-01', 'si': '1693485'}, {'date': '2006-09-01', 'si': '1693500'}, {'date': '2006-10-01', 'si': '1693511'}, {'date': '2006-11-01', 'si': '1693519'}, {'date': '2006-12-01', 'si': '1693525'}, {'date': '2007-01-01', 'si': '1693534'}, {'date': '2007-02-01', 'si': '1693540'}, {'date': '2007-03-01', 'si': '1693515'}, {'date': '2007-04-01', 'si': '1693530'}, {'date': '2007-05-01', 'si': '1693545'}, {'date': '2007-06-01', 'si': '1693550'}, {'date': '2007-07-01', 'si': '1693558'}, {'date': '2007-08-01', 'si': '1693565'}, {'date': '2007-09-01', 'si': '1693573'}, {'date': '2007-10-01', 'si': '1693580'}, {'date': '2007-11-01', 'si': '1693560'}, {'date': '2007-12-01', 'si': '1693572'}, {'date': '2008-01-01', 'si': '1693585'}, {'date': '2008-02-01', 'si': '1693591'}, {'date': '2008-03-01', 'si': '1693598'}, {'date': '2008-04-01', 'si': '1693606'}, {'date': '2008-05-01', 'si': '1693613'}, {'date': '2008-06-01', 'si': '1693590'}, {'date': '2008-07-01', 'si': '1693602'}, {'date': '2008-08-01', 'si': '1693617'}, {'date': '2008-09-01', 'si': '1693624'}, {'date': '2008-10-01', 'si': '1693631'}, {'date': '2008-11-01', 'si': '1693639'}, {'date': '2008-12-01', 'si': '1693645'}, {'date': '2009-01-01', 'si': '1693618'}, {'date': '2009-02-01', 'si': '1693632'}, {'date': '2009-03-01', 'si': '1693647'}, {'date': '2009-04-01', 'si': '1693657'}, {'date': '2009-05-01', 'si': '1693664'}, {'date': '2009-06-01', 'si': '1693670'}, {'date': '2009-07-01', 'si': '1693678'}, {'date': '2009-08-01', 'si': '1693685'}, {'date': '2009-09-01', 'si': '1693662'}, {'date': '2009-10-01', 'si': '1693677'}, {'date': '2009-11-01', 'si': '1693656'}, {'date': '2009-12-01', 'si': '1693696'}, {'date': '2010-01-01', 'si': '1693705'}, {'date': '2010-02-01', 'si': '1693711'}, {'date': '2010-03-01', 'si': '1693718'}, {'date': '2010-04-01', 'si': '1693690'}, {'date': '2010-05-01', 'si': '1693707'}, {'date': '2010-06-01', 'si': '1693719'}, {'date': '2010-07-01', 'si': '1693729'}, {'date': '2010-08-01', 'si': '1693736'}, {'date': '2010-09-01', 'si': '1693744'}, {'date': '2010-10-01', 'si': '1693751'}, {'date': '2010-11-01', 'si': '1693759'}, {'date': '2010-12-01', 'si': '1693734'}, {'date': '2011-01-01', 'si': '1693752'}, {'date': '2011-02-01', 'si': '1693728'}, {'date': '2011-03-01', 'si': '1693769'}, {'date': '2011-04-01', 'si': '1693777'}, {'date': '2011-05-01', 'si': '1693784'}, {'date': '2011-06-01', 'si': '1693790'}, {'date': '2011-07-01', 'si': '1693762'}, {'date': '2011-08-01', 'si': '1693779'}, {'date': '2011-09-01', 'si': '1693794'}, {'date': '2011-10-01', 'si': '1693802'}, {'date': '2011-11-01', 'si': '1693810'}, {'date': '2011-12-01', 'si': '1693816'}, {'date': '2012-01-01', 'si': '1693825'}, {'date': '2012-02-01', 'si': '1693831'}, {'date': '2012-03-01', 'si': '1693809'}, {'date': '2012-04-01', 'si': '1693824'}, {'date': '2012-05-01', 'si': '1693835'}, {'date': '2012-06-01', 'si': '1693843'}, {'date': '2012-07-01', 'si': '1693849'}, {'date': '2012-08-01', 'si': '1693856'}, {'date': '2012-09-01', 'si': '1693864'}, {'date': '2012-10-01', 'si': '1693839'}, {'date': '2012-11-01', 'si': '1693854'}, {'date': '2012-12-01', 'si': '1693866'}, {'date': '2013-01-01', 'si': '1693876'}, {'date': '2013-02-01', 'si': '1693882'}, {'date': '2013-03-01', 'si': '1693889'}, {'date': '2013-04-01', 'si': '1693897'}, {'date': '2013-05-01', 'si': '1693904'}, {'date': '2013-06-01', 'si': '1693881'}, {'date': '2013-07-01', 'si': '1693896'}, {'date': '2013-08-01', 'si': '1693907'}, {'date': '2013-09-01', 'si': '1693915'}, {'date': '2013-10-01', 'si': '1693922'}, {'date': '2013-11-01', 'si': '1693930'}, {'date': '2013-12-01', 'si': '1693936'}, {'date': '2014-01-01', 'si': '1693914'}, {'date': '2014-02-01', 'si': '1693926'}, {'date': '2014-03-01', 'si': '1693941'}, {'date': '2014-04-01', 'si': '1693948'}, {'date': '2014-05-01', 'si': '1693955'}, {'date': '2014-06-01', 'si': '1693961'}, {'date': '2014-07-01', 'si': '1693969'}, {'date': '2014-08-01', 'si': '1693976'}, {'date': '2014-09-01', 'si': '1693956'}, {'date': '2014-10-01', 'si': '1693971'}, {'date': '2014-11-01', 'si': '1693981'}, {'date': '2014-12-01', 'si': '1693987'}, {'date': '2015-01-01', 'si': '1693996'}, {'date': '2015-02-01', 'si': '1694002'}, {'date': '2015-03-01', 'si': '1694009'}, {'date': '2015-04-01', 'si': '1693986'}, {'date': '2015-05-01', 'si': '1694001'}, {'date': '2015-06-01', 'si': '1694013'}, {'date': '2015-07-01', 'si': '1694017'}, {'date': '2015-08-01', 'si': '1694207'}, {'date': '2015-09-01', 'si': '1695300'}, {'date': '2015-10-01', 'si': '1696668'}, {'date': '2015-11-01', 'si': '1697690'}, {'date': '2015-12-01', 'si': '1698634'}, {'date': '2016-01-01', 'si': '1700263'}, {'date': '2016-02-01', 'si': '1700911'}, {'date': '2016-03-01', 'si': '1702328'}, {'date': '2016-04-01', 'si': '1703517'}]
ids2 = [{'si': '1508516', 'date': '1981-09-01'}, {'si': '1508444', 'date': '1981-10-01'}, {'si': '1508557', 'date': '1981-11-01'}, {'si': '1508435', 'date': '1981-12-01'}, {'si': '1508520', 'date': '1982-01-01'}, {'si': '1508448', 'date': '1982-02-01'}, {'si': '1508545', 'date': '1982-03-01'}, {'si': '1508597', 'date': '1982-04-01'}, {'si': '1508533', 'date': '1982-05-01'}, {'si': '1508498', 'date': '1982-06-01'}, {'si': '1508461', 'date': '1982-07-01'}, {'si': '1508525', 'date': '1982-08-01'}, {'si': '1508486', 'date': '1982-09-01'}, {'si': '1508634', 'date': '1982-10-01'}, {'si': '1508638', 'date': '1982-11-01'}, {'si': '1508445', 'date': '1982-12-01'}, {'si': '1508599', 'date': '1983-01-01'}, {'si': '1508507', 'date': '1983-02-01'}, {'si': '1508459', 'date': '1983-03-01'}, {'si': '1508488', 'date': '1983-04-01'}, {'si': '1508440', 'date': '1983-05-01'}, {'si': '1508587', 'date': '1983-06-01'}, {'si': '1508582', 'date': '1983-07-01'}, {'si': '1508550', 'date': '1983-08-01'}, {'si': '1508553', 'date': '1983-09-01'}, {'si': '1508437', 'date': '1983-10-01'}, {'si': '1508614', 'date': '1983-11-01'}, {'si': '1508532', 'date': '1983-12-01'}, {'si': '1508510', 'date': '1984-01-01'}, {'si': '1508602', 'date': '1984-02-01'}, {'si': '1508504', 'date': '1984-03-01'}, {'si': '1508526', 'date': '1984-04-01'}, {'si': '1508527', 'date': '1984-05-01'}, {'si': '1508562', 'date': '1984-06-01'}, {'si': '1508500', 'date': '1984-07-01'}, {'si': '1508438', 'date': '1984-08-01'}, {'si': '1508427', 'date': '1984-09-01'}, {'si': '1508586', 'date': '1984-10-01'}, {'si': '1508475', 'date': '1984-11-01'}, {'si': '1508563', 'date': '1984-12-01'}, {'si': '1508431', 'date': '1985-01-01'}, {'si': '1508640', 'date': '1985-02-01'}, {'si': '1508519', 'date': '1985-03-01'}, {'si': '1508592', 'date': '1985-04-01'}, {'si': '1508626', 'date': '1985-05-01'}, {'si': '1508564', 'date': '1985-06-01'}, {'si': '1508555', 'date': '1985-07-01'}, {'si': '1508641', 'date': '1985-08-01'}, {'si': '1508432', 'date': '1985-09-01'}, {'si': '1508474', 'date': '1985-10-01'}, {'si': '1508612', 'date': '1985-11-01'}, {'si': '1508567', 'date': '1985-12-01'}, {'si': '1508535', 'date': '1986-01-01'}, {'si': '1508506', 'date': '1986-02-01'}, {'si': '1508573', 'date': '1986-03-01'}, {'si': '1508521', 'date': '1986-04-01'}, {'si': '1508528', 'date': '1986-05-01'}, {'si': '1508607', 'date': '1986-06-01'}, {'si': '1508447', 'date': '1986-07-01'}, {'si': '1508442', 'date': '1986-08-01'}, {'si': '1508463', 'date': '1986-09-01'}, {'si': '1508628', 'date': '1986-10-01'}, {'si': '1508643', 'date': '1986-11-01'}, {'si': '1508471', 'date': '1986-12-01'}, {'si': '1508430', 'date': '1987-01-01'}, {'si': '1508598', 'date': '1987-02-01'}, {'si': '1508534', 'date': '1987-03-01'}, {'si': '1508558', 'date': '1987-04-01'}, {'si': '1508594', 'date': '1987-05-01'}, {'si': '1508436', 'date': '1987-06-01'}, {'si': '1508494', 'date': '1987-07-01'}, {'si': '1508478', 'date': '1987-08-01'}, {'si': '1508446', 'date': '1987-09-01'}, {'si': '1508625', 'date': '1987-10-01'}, {'si': '1508633', 'date': '1987-11-01'}, {'si': '1508433', 'date': '1987-12-01'}, {'si': '1508605', 'date': '1988-01-01'}, {'si': '1508449', 'date': '1988-02-01'}, {'si': '1508517', 'date': '1988-03-01'}, {'si': '1508470', 'date': '1988-04-01'}, {'si': '1508576', 'date': '1988-05-01'}, {'si': '1508559', 'date': '1988-06-01'}, {'si': '1508481', 'date': '1988-07-01'}, {'si': '1508637', 'date': '1988-08-01'}, {'si': '1508606', 'date': '1988-09-01'}, {'si': '1508458', 'date': '1988-10-01'}, {'si': '1508441', 'date': '1988-11-01'}, {'si': '1508457', 'date': '1988-12-01'}, {'si': '1508630', 'date': '1989-01-01'}, {'si': '1508595', 'date': '1989-02-01'}, {'si': '1508631', 'date': '1989-03-01'}, {'si': '1508635', 'date': '1989-04-01'}, {'si': '1508439', 'date': '1989-05-01'}, {'si': '1508579', 'date': '1989-06-01'}, {'si': '1508497', 'date': '1989-07-01'}, {'si': '1508578', 'date': '1989-08-01'}, {'si': '1508565', 'date': '1989-09-01'}, {'si': '1508632', 'date': '1989-10-01'}, {'si': '1508426', 'date': '1989-11-01'}, {'si': '1508499', 'date': '1989-12-01'}, {'si': '1508503', 'date': '1990-01-01'}, {'si': '1508560', 'date': '1990-02-01'}, {'si': '1508536', 'date': '1990-03-01'}, {'si': '1508515', 'date': '1990-04-01'}, {'si': '1508524', 'date': '1990-05-01'}, {'si': '1508569', 'date': '1990-06-01'}, {'si': '1508571', 'date': '1990-07-01'}, {'si': '1508511', 'date': '1990-08-01'}, {'si': '1508434', 'date': '1990-09-01'}, {'si': '1508538', 'date': '1990-10-01'}, {'si': '1508561', 'date': '1990-11-01'}, {'si': '1508473', 'date': '1990-12-01'}, {'si': '1508588', 'date': '1991-01-01'}, {'si': '1508583', 'date': '1991-02-01'}, {'si': '1508531', 'date': '1991-03-01'}, {'si': '1508484', 'date': '1991-04-01'}, {'si': '1508530', 'date': '1991-05-01'}, {'si': '1508639', 'date': '1991-06-01'}, {'si': '1508513', 'date': '1991-07-01'}, {'si': '1508623', 'date': '1991-08-01'}, {'si': '1508584', 'date': '1991-09-01'}, {'si': '1508577', 'date': '1991-10-01'}, {'si': '1508454', 'date': '1991-11-01'}, {'si': '1508543', 'date': '1991-12-01'}, {'si': '1508540', 'date': '1992-01-01'}, {'si': '1508600', 'date': '1992-02-01'}, {'si': '1508514', 'date': '1992-03-01'}, {'si': '1508611', 'date': '1992-04-01'}, {'si': '1508596', 'date': '1992-05-01'}, {'si': '1508624', 'date': '1992-06-01'}, {'si': '1508549', 'date': '1992-07-01'}, {'si': '1508455', 'date': '1992-08-01'}, {'si': '1508609', 'date': '1992-09-01'}, {'si': '1508476', 'date': '1992-10-01'}, {'si': '1508462', 'date': '1992-11-01'}, {'si': '1508464', 'date': '1992-12-01'}, {'si': '1508552', 'date': '1993-01-01'}, {'si': '1508451', 'date': '1993-02-01'}, {'si': '1508610', 'date': '1993-03-01'}, {'si': '1508492', 'date': '1993-04-01'}, {'si': '1508619', 'date': '1993-05-01'}, {'si': '1508495', 'date': '1993-06-01'}, {'si': '1508502', 'date': '1993-07-01'}, {'si': '1508468', 'date': '1993-08-01'}, {'si': '1508480', 'date': '1993-09-01'}, {'si': '1508472', 'date': '1993-10-01'}, {'si': '1508487', 'date': '1993-11-01'}, {'si': '1508613', 'date': '1993-12-01'}, {'si': '1508593', 'date': '1994-01-01'}, {'si': '1508512', 'date': '1994-02-01'}, {'si': '1508469', 'date': '1994-03-01'}, {'si': '1508537', 'date': '1994-04-01'}, {'si': '1508548', 'date': '1994-05-01'}, {'si': '1508601', 'date': '1994-06-01'}, {'si': '1508615', 'date': '1994-07-01'}, {'si': '1508604', 'date': '1994-08-01'}, {'si': '1508556', 'date': '1994-09-01'}, {'si': '1508493', 'date': '1994-10-01'}, {'si': '1508453', 'date': '1994-11-01'}, {'si': '1508575', 'date': '1994-12-01'}, {'si': '1508620', 'date': '1995-01-01'}, {'si': '1508547', 'date': '1995-02-01'}, {'si': '1508460', 'date': '1995-03-01'}, {'si': '1508485', 'date': '1995-04-01'}, {'si': '1508590', 'date': '1995-05-01'}, {'si': '1508570', 'date': '1995-06-01'}, {'si': '1508618', 'date': '1995-07-01'}, {'si': '1508509', 'date': '1995-08-01'}, {'si': '1508603', 'date': '1995-09-01'}, {'si': '1508508', 'date': '1995-10-01'}, {'si': '1508518', 'date': '1995-11-01'}, {'si': '1508589', 'date': '1995-12-01'}, {'si': '1508523', 'date': '1996-01-01'}, {'si': '1508544', 'date': '1996-02-01'}, {'si': '1508616', 'date': '1996-03-01'}, {'si': '1508580', 'date': '1996-04-01'}, {'si': '1508591', 'date': '1996-05-01'}, {'si': '1508443', 'date': '1996-06-01'}, {'si': '1508542', 'date': '1996-07-01'}, {'si': '1508490', 'date': '1996-08-01'}, {'si': '1508566', 'date': '1996-09-01'}, {'si': '1508629', 'date': '1996-10-01'}, {'si': '1508546', 'date': '1996-11-01'}, {'si': '1508428', 'date': '1996-12-01'}, {'si': '1508585', 'date': '1997-01-01'}, {'si': '1508496', 'date': '1997-02-01'}, {'si': '1508482', 'date': '1997-03-01'}, {'si': '1508622', 'date': '1997-04-01'}, {'si': '1508452', 'date': '1997-05-01'}, {'si': '1508568', 'date': '1997-06-01'}, {'si': '1508636', 'date': '1997-07-01'}, {'si': '1508642', 'date': '1997-08-01'}, {'si': '1508554', 'date': '1997-09-01'}, {'si': '1508489', 'date': '1997-10-01'}, {'si': '1508581', 'date': '1997-11-01'}, {'si': '1508617', 'date': '1997-12-01'}, {'si': '1508505', 'date': '1998-01-01'}, {'si': '1508539', 'date': '1998-02-01'}, {'si': '1508529', 'date': '1998-03-01'}, {'si': '1508467', 'date': '1998-04-01'}, {'si': '1508627', 'date': '1998-05-01'}, {'si': '1508466', 'date': '1998-06-01'}, {'si': '1508465', 'date': '1998-07-01'}, {'si': '1508491', 'date': '1998-08-01'}, {'si': '1508608', 'date': '1998-09-01'}, {'si': '1508551', 'date': '1998-10-01'}, {'si': '1508645', 'date': '1998-11-01'}, {'si': '1508479', 'date': '1998-12-01'}, {'si': '1508456', 'date': '1999-01-01'}, {'si': '1508477', 'date': '1999-02-01'}, {'si': '1508644', 'date': '1999-03-01'}, {'si': '1508621', 'date': '1999-04-01'}, {'si': '1508522', 'date': '1999-05-01'}, {'si': '1508429', 'date': '1999-06-01'}, {'si': '1508501', 'date': '1999-07-01'}, {'si': '1508483', 'date': '1999-08-01'}, {'si': '1508574', 'date': '1999-09-01'}, {'si': '1508541', 'date': '1999-10-01'}, {'si': '1508572', 'date': '1999-11-01'}, {'si': '1508450', 'date': '1999-12-01'}, {'si': '1508694', 'date': '2000-01-01'}, {'si': '1508665', 'date': '2000-02-01'}, {'si': '1508675', 'date': '2000-03-01'}, {'si': '1508699', 'date': '2000-04-01'}, {'si': '1508724', 'date': '2000-05-01'}, {'si': '1508668', 'date': '2000-06-01'}, {'si': '1508686', 'date': '2000-07-01'}, {'si': '1508672', 'date': '2000-08-01'}, {'si': '1508648', 'date': '2000-09-01'}, {'si': '1508652', 'date': '2000-10-01'}, {'si': '1508702', 'date': '2000-11-01'}, {'si': '1508712', 'date': '2000-12-01'}, {'si': '1508653', 'date': '2001-01-01'}, {'si': '1508678', 'date': '2001-02-01'}, {'si': '1508693', 'date': '2001-03-01'}, {'si': '1508720', 'date': '2001-04-01'}, {'si': '1508670', 'date': '2001-05-01'}, {'si': '1508654', 'date': '2001-06-01'}, {'si': '1508656', 'date': '2001-07-01'}, {'si': '1508679', 'date': '2001-08-01'}, {'si': '1508727', 'date': '2001-09-01'}, {'si': '1508680', 'date': '2001-10-01'}, {'si': '1508664', 'date': '2001-11-01'}, {'si': '1508707', 'date': '2001-12-01'}, {'si': '1508709', 'date': '2002-01-01'}, {'si': '1508721', 'date': '2002-02-01'}, {'si': '1508692', 'date': '2002-03-01'}, {'si': '1508649', 'date': '2002-04-01'}, {'si': '1508714', 'date': '2002-05-01'}, {'si': '1508723', 'date': '2002-06-01'}, {'si': '1508666', 'date': '2002-07-01'}, {'si': '1508646', 'date': '2002-08-01'}, {'si': '1508684', 'date': '2002-09-01'}, {'si': '1508677', 'date': '2002-10-01'}, {'si': '1508726', 'date': '2002-11-01'}, {'si': '1508683', 'date': '2002-12-01'}, {'si': '1508698', 'date': '2003-01-01'}, {'si': '1508669', 'date': '2003-02-01'}, {'si': '1508663', 'date': '2003-03-01'}, {'si': '1508691', 'date': '2003-04-01'}, {'si': '1508719', 'date': '2003-05-01'}, {'si': '1508704', 'date': '2003-06-01'}, {'si': '1508651', 'date': '2003-07-01'}, {'si': '1508660', 'date': '2003-08-01'}, {'si': '1508703', 'date': '2003-09-01'}, {'si': '1508725', 'date': '2003-10-01'}, {'si': '1508717', 'date': '2003-11-01'}, {'si': '1508676', 'date': '2003-12-01'}, {'si': '1508685', 'date': '2004-01-01'}, {'si': '1508689', 'date': '2004-02-01'}, {'si': '1508657', 'date': '2004-03-01'}, {'si': '1508667', 'date': '2004-04-01'}, {'si': '1508716', 'date': '2004-05-01'}, {'si': '1508682', 'date': '2004-06-01'}, {'si': '1508687', 'date': '2004-07-01'}, {'si': '1508650', 'date': '2004-08-01'}, {'si': '1508647', 'date': '2004-09-01'}, {'si': '1508706', 'date': '2004-10-01'}, {'si': '1508713', 'date': '2004-11-01'}, {'si': '1508671', 'date': '2004-12-01'}, {'si': '1508688', 'date': '2005-01-01'}, {'si': '1508695', 'date': '2005-02-01'}, {'si': '1508681', 'date': '2005-03-01'}, {'si': '1508661', 'date': '2005-04-01'}, {'si': '1508728', 'date': '2005-05-01'}, {'si': '1508722', 'date': '2005-06-01'}, {'si': '1508658', 'date': '2005-07-01'}, {'si': '1508673', 'date': '2005-08-01'}, {'si': '1508729', 'date': '2005-09-01'}, {'si': '1508655', 'date': '2005-10-01'}, {'si': '1508697', 'date': '2005-11-01'}, {'si': '1508701', 'date': '2005-12-01'}, {'si': '1508659', 'date': '2006-01-01'}, {'si': '1508710', 'date': '2006-02-01'}, {'si': '1508711', 'date': '2006-03-01'}, {'si': '1508708', 'date': '2006-04-01'}, {'si': '1508715', 'date': '2006-05-01'}, {'si': '1508662', 'date': '2006-06-01'}, {'si': '1508705', 'date': '2006-07-01'}, {'si': '1508718', 'date': '2006-08-01'}, {'si': '1508700', 'date': '2006-09-01'}, {'si': '1508674', 'date': '2006-10-01'}, {'si': '1508690', 'date': '2006-11-01'}, {'si': '1508696', 'date': '2006-12-01'}]


def get_id(url, start, end):
    ret = []

    for year in range(start, end + 1):
        u = url.format(year)
        r = requests.get(u)
        soup = BeautifulSoup(r.text, 'lxml')

        ids = soup.find_all('div', class_='slider-elem month')

        for id in ids:
            link = id.find_all('a')[0]
            data = link['onclick']

            date = data[23:33]
            si = data[13:20]

            ret.append({'date': date, 'si': si})

        print('Completed year {}.'.format(year))

    return ret


def download(url, ids):
    for id in ids:
        date = id['date']
        si = id['si']
        u = url.format(si)

        r = requests.get(u, stream=True)

        with open('{}.csv'.format(date), 'wb') as f:
            for chunk in r.iter_content(chunk_size=1024):
                if chunk:
                    f.write(chunk)

        print('Downloaded data for {}.'.format(date))


def analyze(ids):
    north_lim = 45
    south_lim = 90 + 55

    ret = []

    for id in ids:
        date = id['date']
        array = []

        print('Analyzing {}.'.format(date))

        with open('{}.csv'.format(date), 'r') as f:
            for line in f:
                line = line.strip()
                sub = line.split(',')
                sub = [float(x) for x in sub]
                array.append(sub)

        array = np.array(array)
        array[array > 1000] = np.nan

        north = array[:north_lim, :]
        south = array[south_lim:, :]

        avg_north = np.nanmean(north)
        avg_south = np.nanmean(south)
        avg_global = np.nanmean(array)

        ret.append({'date': date, 'north': avg_north, 'south': avg_south, 'global': avg_global})

    return ret


def write_csv(iterable, filename, fieldnames=None):
    with open('{}.csv'.format(filename), 'w', newline='') as f:
        if fieldnames is None:
            fieldnames = list(iterable[0].keys())

        writer = csv.DictWriter(f, fieldnames)

        writer.writeheader()
        writer.writerows(iterable)


data = analyze(ids2)
write_csv(data, 'combined', ['date', 'north', 'south', 'global'])